
<% 
# Create the query string for submitting measurements for all variables
vquery = ''               
  i = 0                   
  vquery = '&'            
  @varnames.each do |v|
    vquery += v[0] 
    vquery += '='
    vquery += v[1]
    if i < @varnames.count-1        
      vquery += '&'       
    end                   
    i = i + 1             
  end
%>

<div class="last_url">
<%= @instrument.last_url %>
</div>
<p>
Download current day as
  <%= link_to("CSV",  instrument_url( :format => 'csv')  )%>, 
  <%= link_to("XML",  instrument_url( :format => 'xml')  )%>,
  <%= link_to("JSON", instrument_url( :format => 'jsf') )%>
</p>
<table>
<tr>
  <td><strong>Instrument</strong></td>
  <td><%= best_in_place @instrument, :name, :as => :input %></td>
</tr>
<tr>
  <td><strong>Status</strong></td>
    <td><% if @instrument.is_receiving_data %>
      <%= image_tag('glossy-green-icon-button-th.png', size:"16")%>
    <% else %>
      <%= image_tag('glossy-red-icon-button-th.png', size:"16")%>
    <% end %>
  </td>
</tr>
<tr>
  <td><strong>Site</strong></td>
  <td><%= best_in_place @instrument, :site_id, :as => :select, :collection => Site::list_site_options  %></td>
</tr>
<tr>
  <td><strong>Description</strong></td>
  <td><%= best_in_place @instrument, 
    :description, 
    :as => :input,
    :type => :textarea,
    :html_attrs => {:style => 'width:500px; height:100px;'} %></td>
</tr>
<tr>
  <td><strong>Data ingest/fetch</strong></td>
  <td><%= link_to 'Data URLs', about_data_urls_path(instrument_id: @instrument.id) %></td>
</tr>
<tr>
  <td><strong>Instrument ID</strong></td>
  <td><%= @instrument.id %></td>
</tr>
<tr>
  <td><strong>All Measurements</strong></td>
  <td><%= @instrument.measurements.count %>
</tr>
<tr>
  <td><strong>Test Measurements</strong></td>
  <td><%= @instrument.measurements.where(test: 1).count %>
  <td><%= button_to 'Delete Test Data', measurements_delete_test_path(instrument_id: @instrument.id), 
    data: { confirm: "Are you sure you want to delete the test data for \n#{@instrument.name}}?\n\nALL TEST DATA WILL BE LOST" } %></td>
  </td>
</tr>
<tr>
  <td><strong>Display points</strong></td>
  <td><%= best_in_place @instrument, :display_points, :as => :input %></td>
</tr>
<tr>
  <td><strong>Measurement<br/>interval (s)</strong></td>
  <td><%= best_in_place @instrument, :seconds_before_timeout, :as => :input %></td>
</tr>
<tr>
  <td style="vertical-align:top"><strong>Variables</strong></td>
	<td>
	  <table id="variables_list">
		  <% @instrument.vars.each do |variable| %>
      <tr>
				<%= render partial: 'vars/bip_form', locals: {variable: variable} %>
      </tr>
      <% end %>		
    </td>
    </table>
  </td>
</tr>
<tr>
<td></td>
<td>
<%= form_for :var, url: vars_path, :remote => false, :format => :js do |f| %>
	<%= f.hidden_field :name, :value => 'name' %>
	<%= f.hidden_field :shortname, :value => 'shortname' %>
	<%= f.hidden_field :instrument_id, :value => @instrument.id %>

	 <%= f.submit :value	 => 'Add a New Variable' %>
<% end %>
</td>
</table>


<div class="instrumentstrip">
Graph:
<% @varnames.each do |v| %>
  <%= link_to v[1], instrument_path(@instrument, var: v[0]) %>
<% end %>
</div>

<%= render 'graph' %>


<%= link_to 'Back', instruments_path %>
