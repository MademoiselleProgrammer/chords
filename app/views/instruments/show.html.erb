
<% 
# Create the query string for submitting measurements for all variables
vquery = ''               
  i = 0                   
  vquery = '&'            
  @varnames.each do |v|
    vquery += v[0] 
    vquery += '='
    vquery += v[1]
    if i < @varnames.count-1        
      vquery += '&'       
    end                   
    i = i + 1             
  end
%>

<div class="last_url">
<%= @instrument.last_url %>
</div>

<div>
	  <strong>Instrument Name:</strong>
	<%= best_in_place @instrument, :name, :as => :input %>
</div>

<div>
	  <strong>ID:</strong>
	   instrument_id=<%= @instrument.id %>
</div>

<div>
	  <strong>Site:</strong>
	<%= best_in_place @instrument, :site_id, :as => :select, :collection => Site::list_site_options  %>
</div>

<div>
	  <strong>Display Points:</strong>
	<%= best_in_place @instrument, :display_points, :as => :input %>
</div>

<div>
	  <strong>Expected Data Input Rate (in Seconds):</strong>
	<%= best_in_place @instrument, :seconds_before_timeout, :as => :input %>
</div>



<div>
  <strong>Variables:</strong>
	<table id="variables_list">
		<% @instrument.vars.each do |variable| %>
    <tr>
				<%= render partial: 'vars/bip_form', locals: {variable: variable} %>
    </tr>
    <% end %>		
  </table>
</div>

<div>
	
<%= form_for :var, url: vars_path, :remote => false, :format => :js do |f| %>
	<%= f.hidden_field :name, :value => 'name' %>
	<%= f.hidden_field :shortname, :value => 'shortname' %>
	<%= f.hidden_field :instrument_id, :value => @instrument.id %>

	 <%= f.submit :value	 => 'Add a New Variable' %>
<% end %>
</div>


<div>
<strong>URLs for data ingest and download</strong>
<table>
  <tr>
 	<td>Put values:</td>
	<td><% if @varnames.count > 0 %>
	  <%= url_for(:only_path => false,  :controller => 'measurements', :action => 'url_create', :instrument_id => @instrument.id) %><%= vquery %>
	<% end %></td>
  </tr>
  <tr>
  <td>Fetch CSV file:</td>
  <td><% if @varnames.count > 0 %>
    <%= url_for(:only_path => false,  :controller => 'instruments', :action => 'show', :id => @instrument.id) %>.csv?startsecs=start&endsecs=end
  <% end %></td>
  </tr>
  <tr>
  <td>Fetch JSON:</td>
  <td><% if @varnames.count > 0 %>
    <%= url_for(:only_path => false,  :controller => 'instruments', :action => 'show', :id => @instrument.id) %>.json?startsecs=start&endsecs=end
  <% end %></td>
 </tr>
</table>
<i>'?startsecs=start&endsecs=end' is optional. If left off, the current day will be returned. <br/>
'start' and 'end' specify the number of seconds since the epoch (Jan 1, 1970).</i>
</div>

<p>
  <strong>Number of measurements made:</strong>
  <%= @instrument.measurements.count %> 
	(Download current day as <%=  link_to("CSV", instrument_url( :format => 'csv') )%>, <%=  link_to("XML", instrument_url( :format => 'xml') )%> )
</p>

<div class="instrumentstrip">
Graph:
<% @varnames.each do |v| %>
  <%= link_to v[1], instrument_path(@instrument, var: v[0]) %>
<% end %>
</div>

<%= render 'graph' %>


<%= link_to 'Back', instruments_path %>
